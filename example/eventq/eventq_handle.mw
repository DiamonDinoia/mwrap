% eventq_handle.mw
%   Simple event queue for use in MATLAB event-driven simulations.
%   Uses the MATLAB 2008+ OO system for encapsulating the event queue.
%
% Copyright (c) 2007  David Bindel
% See the file COPYING for copying permissions

$ #include <queue>
$
$ typedef std::pair<double, int>                      Event;
$ typedef std::priority_queue< Event, 
$                              std::vector<Event>, 
$                              std::greater<Event> >  EventQueue;


@ eventqh.m --------------------------------------------

classdef eventqh < handle

  properties
    mwptr
  end

  methods

    function [qobj] = eventqh()
      # EventQueue* q = new EventQueue();
      qobj.mwptr = q;
    end

    function delete(q)
      qp = q.mwptr;
      if isempty(qp)
        return;
      end
      # delete(EventQueue* qp);
      q.mwptr = [];
    end

    function e = empty(q)
      qp = q.mwptr;
      # int e = qp->EventQueue.empty();
    end

    function [id, t] = pop(q)
      qp = q.mwptr;
      $ void pop_event(EventQueue* q, int& id, double& t) {
      $     t  = q->top().first;
      $     id = q->top().second;
      $     q->pop();
      $ }
      # pop_event(EventQueue* qp, output int& id, output double& t);
    end

    function push(q, id, t)
      qp = q.mwptr;
      $ void push_events(EventQueue* q, int* id, double* t, int m)
      $ {
      $     for (int i = 0; i < m; ++i)
      $         q->push(Event(t[i], id[i]));
      $ }
      m = length(id);
      # push_events(EventQueue* qp, int[m] id, double[m] t, int m);
    end

  end
end
